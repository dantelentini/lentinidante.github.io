<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dante Lentini</title>
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <main>
        <canvas id="starfield" style="position:fixed;inset:0;z-index:0;pointer-events:none;display:none"></canvas>
        
        <!-- Content Display Areas -->
        <div class="content-grid" style="z-index:1">
            <div class="content-items" id="content-items">
                <!-- Content will be dynamically populated here -->
            </div>
        </div>
        
        <h1>Hi,</h1>
        <p>
            I like to <button id="read-btn">read</button>, <button id="write-btn">write</button>, and <button id="listen-btn">listen</button>.<br><br>
            I'm a Growth Hacker. In my past, I<br>
            left college, made <span class="white">tiktoks</span> and joined<br>
            <span class="white">startups</span>â€” all of which led me to SF,<br>
            where I'm now at <span class="white-bold">Founders, Inc.</span>
        </p>
        <div class="signature">
         MSHF,<br>
            Dante Lentini
        </div>
        <nav class="social-links">
            <a href="mailto:dantelentinics@gmail.com">Email</a>
            <a href="https://linkedin.com/in/lentinidante" target="_blank">LinkedIn</a>
            <a href="https://x.com/lentinidante" target="_blank">X</a>
            <a href="momsaidhavefun.pdf" target="_blank"><3</a>
            <a href="#" id="dark-mode-toggle">dark-mode.exe</a>
        </nav>
    </main>
    
    <!-- Audio element for music playback -->
    <audio id="audio-player" preload="none"></audio>
    
    <script>
        // Theme init
        const rootEl = document.documentElement;
        const THEME_KEY = 'theme-preference';
        const sfx = new Audio('assets/audio/dark-mode.mp3');
        sfx.preload = 'auto';
        sfx.crossOrigin = 'anonymous';
        sfx.volume = 1.0;
        const initialStarCanvas = document.getElementById('starfield');
        // Force default light on load; ignore saved dark preference
        rootEl.removeAttribute('data-theme');
        if (initialStarCanvas) initialStarCanvas.style.display = 'none';
        localStorage.setItem(THEME_KEY, 'light');

        // Content data
        const contentData = {
            read: [
                { type: 'book', image: 'assets/images/books/blue_ocean.jpg', title: 'Blue Ocean Strategy' },
                { type: 'book', image: 'assets/images/books/build.jpg', title: 'Build' },
                { type: 'book', image: 'assets/images/books/founding_sales.jpg', title: 'Founding Sales' },
                { type: 'book', image: 'assets/images/books/lean_startup.jpg', title: 'The Lean Startup' },
                { type: 'book', image: 'assets/images/books/read_write_own.jpg', title: 'Read Write Own' },
                { type: 'book', image: 'assets/images/books/the_cold_start.jpg', title: 'The Cold Start Problem' },
                { type: 'book', image: 'assets/images/books/the_courage.jpg', title: 'The Courage to be Disliked' },
                { type: 'book', image: 'assets/images/books/total_freedom.jpg', title: 'Total Freedom' }
            ],
            write: [
                { type: 'letter', image: 'assets/images/books/blue_ocean.jpg', title: 'Letter 1' },
                { type: 'letter', image: 'assets/images/books/build.jpg', title: 'Letter 2' },
                { type: 'letter', image: 'assets/images/books/founding_sales.jpg', title: 'Letter 3' },
                { type: 'letter', image: 'assets/images/books/lean_startup.jpg', title: 'Letter 4' },
                { type: 'letter', image: 'assets/images/books/read_write_own.jpg', title: 'Letter 5' },
                { type: 'letter', image: 'assets/images/books/the_cold_start.jpg', title: 'Letter 6' },
                { type: 'letter', image: 'assets/images/books/the_courage.jpg', title: 'Letter 7' },
                { type: 'letter', image: 'assets/images/books/total_freedom.jpg', title: 'Letter 8' }
            ],
            listen: [
                { type: 'album', image: 'assets/images/albums/album-01.jpg', title: 'Track 01', audio: 'assets/audio/track-01.mp3' },
                { type: 'album', image: 'assets/images/albums/album-02.jpg', title: 'Track 02', audio: 'assets/audio/track-02.mp3' },
                { type: 'album', image: 'assets/images/albums/album-03.jpg', title: 'Track 03', audio: 'assets/audio/track-03.mp3' },
                { type: 'album', image: 'assets/images/albums/album-04.jpg', title: 'Track 04', audio: 'assets/audio/track-04.mp3' },
                { type: 'album', image: 'assets/images/albums/album-05.jpg', title: 'Track 05', audio: 'assets/audio/track-05.mp3' },
                { type: 'album', image: 'assets/images/albums/album-06.jpg', title: 'Track 06', audio: 'assets/audio/track-06.mp3' },
                { type: 'album', image: 'assets/images/albums/album-07.jpg', title: 'Track 07', audio: 'assets/audio/track-07.mp3' },
                { type: 'album', image: 'assets/images/albums/album-08.jpg', title: 'Track 08', audio: 'assets/audio/track-08.mp3' }
            ]
        };

        // DOM elements
        const readBtn = document.getElementById('read-btn');
        const writeBtn = document.getElementById('write-btn');
        const listenBtn = document.getElementById('listen-btn');
        const contentItems = document.getElementById('content-items');
        const audioPlayer = document.getElementById('audio-player');
        const darkToggle = document.getElementById('dark-mode-toggle');
        const starCanvas = document.getElementById('starfield');
        let isThemeToggling = false;
        let toggleTimeoutId = null;
        let pendingDark = false; // tracks a scheduled (not yet applied) dark mode
        let preloadedRead = false;

        let currentMode = null;
        let currentlyPlaying = null;
        let isButtonActive = false; // Track if a button is actively pressed
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        // (mobile audio interaction tracking no longer required)

        // Button event listeners
        readBtn.addEventListener('click', () => {
            if (currentMode === 'read' && isButtonActive) {
                // If same button is clicked and active, deactivate it
                hideContent();
            } else {
                isButtonActive = true;
                showContent('read');
            }
        });
        writeBtn.addEventListener('click', () => {
            if (currentMode === 'write' && isButtonActive) {
                // If same button is clicked and active, deactivate it
                hideContent();
            } else {
                isButtonActive = true;
                showContent('write');
            }
        });
        listenBtn.addEventListener('click', () => {
            if (currentMode === 'listen' && isButtonActive) {
                // If same button is clicked and active, deactivate it
                hideContent();
            } else {
                isButtonActive = true;
                showContent('listen');
            }
        });

        // Hover event listeners
        readBtn.addEventListener('mouseenter', () => {
            if (!isButtonActive) {
                showContent('read');
            }
        });
        writeBtn.addEventListener('mouseenter', () => {
            if (!isButtonActive) {
                showContent('write');
            }
        });
        listenBtn.addEventListener('mouseenter', () => {
            if (!isButtonActive) {
                showContent('listen');
            }
        });

        // Mouse leave events to hide content when not hovering (only if no button is active)
        [readBtn, writeBtn, listenBtn].forEach(btn => {
            btn.addEventListener('mouseleave', () => {
                setTimeout(() => {
                    if (!isHoveringAnyButton() && !isButtonActive) {
                        hideContent();
                    }
                }, 100);
            });
        });

        // Click outside to deactivate button mode (but not on mobile)
        document.addEventListener('click', (e) => {
            // Don't hide content if clicking on album items
            if (e.target.closest('.content-item')) {
                return;
            }
            
            if (!isMobile && !readBtn.contains(e.target) && !writeBtn.contains(e.target) && !listenBtn.contains(e.target)) {
                isButtonActive = false;
                if (!isHoveringAnyButton()) {
                    hideContent();
                }
            }
        });

        function isHoveringAnyButton() {
            return readBtn.matches(':hover') || writeBtn.matches(':hover') || listenBtn.matches(':hover');
        }

        function showContent(mode) {
            // Remove active class from all buttons
            [readBtn, writeBtn, listenBtn].forEach(btn => btn.classList.remove('active'));
            
            // Add active class to current button
            document.getElementById(mode + '-btn').classList.add('active');

            // Update current mode
            currentMode = mode;

            // Clear existing content
            contentItems.innerHTML = '';

            // Add new content items
            contentData[mode].forEach((item, index) => {
                const contentItem = document.createElement('div');
                contentItem.className = 'content-item';
                contentItem.innerHTML = `<img src="${item.image}" alt="${item.title}" title="${item.title}">`;
                
                // Add click event for albums
                if (item.type === 'album') {
                    contentItem.addEventListener('click', (e) => {
                        e.stopPropagation();
                        e.preventDefault();
                        
                        playAudio(item.audio, contentItem);
                        // Prevent the document click handler from hiding content
                        isButtonActive = true;
                    });
                    
                    // Add touch events for mobile/iOS
                    contentItem.addEventListener('touchend', (e) => {
                        e.stopPropagation();
                        e.preventDefault();
                        
                        playAudio(item.audio, contentItem);
                        // Prevent the document click handler from hiding content
                        isButtonActive = true;
                    });
                }
                
                contentItems.appendChild(contentItem);
            });

            // Set the data mode for CSS targeting
            contentItems.setAttribute('data-mode', mode);
            
            // Show content with animation
            contentItems.classList.add('active');
        }

        function hideContent() {
            contentItems.classList.remove('active');
            [readBtn, writeBtn, listenBtn].forEach(btn => btn.classList.remove('active'));
            currentMode = null;
            isButtonActive = false;
        }

        function playAudio(audioSrc, element) {
            // Increment click count for multi-click permission
            
            
            // If clicking the same track, toggle play/pause
            if (currentlyPlaying === audioSrc) {
                if (!audioPlayer.paused) {
                    audioPlayer.pause();
                    currentlyPlaying = null;
                } else {
                    // Try to play with permission handling
                    attemptAudioPlay(audioSrc, element);
                }
                return;
            }

            // Stop currently playing audio and start new one
            if (currentlyPlaying) {
                audioPlayer.pause();
                audioPlayer.currentTime = 0;
            }

            // Try to play new audio
            attemptAudioPlay(audioSrc, element);
        }
        
        function attemptAudioPlay(audioSrc, element) {
            // Set audio source and properties for iOS compatibility
            audioPlayer.src = audioSrc;
            audioPlayer.volume = 1.0;
            audioPlayer.preload = 'auto';
            audioPlayer.load();
            
            // For iOS, we need to set the audio context and ensure it's ready
            if (isMobile) {
                // Ensure the audio element is ready
                audioPlayer.addEventListener('canplaythrough', function playWhenReady() {
                    audioPlayer.removeEventListener('canplaythrough', playWhenReady);
                    tryPlayAudio(audioSrc, element);
                }, { once: true });
                
                // Fallback if canplaythrough doesn't fire
                setTimeout(() => {
                    tryPlayAudio(audioSrc, element);
                }, 100);
            } else {
                tryPlayAudio(audioSrc, element);
            }
        }
        
        function tryPlayAudio(audioSrc, element) {
            const playPromise = audioPlayer.play();
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    currentlyPlaying = audioSrc;
                    
                    // Add visual feedback
                    if (element) {
                        element.style.opacity = '0.7';
                        setTimeout(() => {
                            element.style.opacity = '1';
                        }, 200);
                    }
                }).catch(error => {
                    console.log('Audio playback failed:', error);
                    // Show visual feedback that audio failed
                    if (element) {
                        element.style.opacity = '0.5';
                        element.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            element.style.opacity = '1';
                            element.style.transform = 'scale(1)';
                        }, 300);
                    }
                });
            }
        }

        // Handle audio events
        audioPlayer.addEventListener('ended', () => {
            currentlyPlaying = null;
        });

        audioPlayer.addEventListener('error', () => {
            console.log('Audio error occurred');
            currentlyPlaying = null;
        });
        
        // Handle page visibility changes to pause audio when tab is hidden
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && !audioPlayer.paused) {
                audioPlayer.pause();
            }
        });

        // Add touch event listeners for mobile audio permissions
        // mobile audio interaction tracking removed

        function preloadReadImages(){
            if (preloadedRead) return;
            try {
                (contentData.read || []).forEach(item => { const img = new Image(); img.src = item.image; });
                preloadedRead = true;
            } catch(_) {}
        }

        // Dark mode toggle
        darkToggle.addEventListener('click', (e) => {
            e.preventDefault();
            // If a delayed dark is pending, clicking again cancels everything
            if (pendingDark) {
                if (toggleTimeoutId) { clearTimeout(toggleTimeoutId); toggleTimeoutId = null; }
                pendingDark = false;
                isThemeToggling = false;
                // ensure we remain in light mode
                rootEl.removeAttribute('data-theme');
                if (starCanvas) starCanvas.style.display = 'none';
                setAutoCycle(false);
                try { sfx.pause(); sfx.currentTime = 0; } catch(_) {}
                hideContent();
                localStorage.setItem(THEME_KEY, 'light');
                return;
            }
            if (isThemeToggling) return;
            const isDark = rootEl.getAttribute('data-theme') === 'dark';
            const next = isDark ? 'light' : 'dark';
            // guard against rapid re-clicks
            isThemeToggling = true;
            if (toggleTimeoutId) clearTimeout(toggleTimeoutId);
            if (next === 'dark') {
                // delayed enter to dark
                preloadReadImages();
                strobeWindowUntil = performance.now() + 5800;
                // On mobile: do NOT show books immediately to avoid accidental press; reveal with theme
                if (!isMobile) {
                    isButtonActive = true;
                    showContent('read');
                }
                toggleTimeoutId = setTimeout(() => {
                    rootEl.setAttribute('data-theme', 'dark');
                    if (starCanvas) starCanvas.style.display = 'block';
                    // Reveal books exactly when dark applies (mobile and desktop)
                    isButtonActive = true;
                    showContent('read');
                    setAutoCycle(true); // start 118 BPM cycle in dark
                    isThemeToggling = false;
                    strobeWindowUntil = 0; // end strobe window
                    pendingDark = false;
                    localStorage.setItem(THEME_KEY, 'dark');
                }, 5800);
                pendingDark = true;
            } else {
                // instant exit to light, cancel pending enter
                if (toggleTimeoutId) { clearTimeout(toggleTimeoutId); toggleTimeoutId = null; }
                rootEl.removeAttribute('data-theme');
                if (starCanvas) starCanvas.style.display = 'none';
                setAutoCycle(false);
                strobeWindowUntil = 0;
                isThemeToggling = false;
                // stop and reset dark-mode sound so it can restart fresh later
                try { sfx.pause(); sfx.currentTime = 0; } catch (_) {}
                pendingDark = false;
                localStorage.setItem(THEME_KEY, 'light');
            }
            // Play SFX without interrupting main audio
            try {
                if (next === 'dark') {
                    const wasPaused = audioPlayer.paused;
                    sfx.currentTime = 0;
                    sfx.play().catch(() => {});
                    if (!wasPaused && audioPlayer.paused) {
                        audioPlayer.play().catch(() => {});
                    }
                } else {
                    sfx.pause();
                    sfx.currentTime = 0;
                }
            } catch (_) {}
        });

        // Starfield animation (enabled in dark mode)
        (function initStarfield(){
            const canvas = document.getElementById('starfield');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            let stars = [];
            let meteors = [];
            function resize(){
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                stars = Array.from({length: Math.floor((canvas.width*canvas.height)/9000)}, () => ({
                    x: Math.random()*canvas.width,
                    y: Math.random()*canvas.height,
                    tw: Math.random()*Math.PI*2,
                    sp: 0.5 + Math.random()*0.5,
                    r: 0.6 + Math.random()*1.2
                }));
            }
            window.addEventListener('resize', resize);
            resize();
            function tick(){
                if (canvas.style.display !== 'block') { requestAnimationFrame(tick); return; }
                ctx.clearRect(0,0,canvas.width,canvas.height);
                // twinkle stars
                for (const s of stars){
                    s.tw += 0.02*s.sp;
                    const alpha = 0.3 + 0.7*(0.5+0.5*Math.sin(s.tw));
                    ctx.fillStyle = `rgba(255,255,255,${alpha.toFixed(3)})`;
                    ctx.beginPath();
                    ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
                    ctx.fill();
                }
                // meteors
                if (Math.random()<0.01 && meteors.length<2){
                    meteors.push({x: Math.random()*canvas.width, y: -20, vx: -6-Math.random()*4, vy: 10+Math.random()*6, life: 1});
                }
                for (let i=meteors.length-1;i>=0;i--){
                    const m = meteors[i];
                    m.x += m.vx; m.y += m.vy; m.life -= 0.01;
                    const grad = ctx.createLinearGradient(m.x, m.y, m.x-m.vx*6, m.y-m.vy*6);
                    grad.addColorStop(0, 'rgba(255,255,255,0.9)');
                    grad.addColorStop(1, 'rgba(255,255,255,0)');
                    ctx.strokeStyle = grad;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(m.x, m.y);
                    ctx.lineTo(m.x-m.vx*6, m.y-m.vy*6);
                    ctx.stroke();
                    if (m.life<=0 || m.y>canvas.height+50) meteors.splice(i,1);
                }
                requestAnimationFrame(tick);
            }
            requestAnimationFrame(tick);
        })();

        // 118 BPM half-beat auto-cycle (255ms)
        const beatMs = 510;
        let cycleIndex = 0;
        const cycleButtons = [readBtn, writeBtn, listenBtn];
        let autoCycleTimer = null;
        function setAutoCycle(on){
            if (on && !autoCycleTimer){
                autoCycleTimer = setInterval(() => {
                    const btn = cycleButtons[cycleIndex % cycleButtons.length];
                    btn.classList.add('active');
                    setTimeout(()=>btn.classList.remove('active'), Math.max(120, Math.floor(beatMs*0.45)));
                    isButtonActive = false;
                    showContent(['read','write','listen'][cycleIndex % 3]);
                    cycleIndex++;
                }, beatMs);
            } else if (!on && autoCycleTimer){
                clearInterval(autoCycleTimer);
                autoCycleTimer = null;
            }
        }
        // keep off on load to prevent flashing
        setAutoCycle(false);
    </script>
</body>
</html>

